/*!
 * SessionDialog jQuery UI widget v1.0 - http://portablesheep.github.com/SessionDialog
 * Copyright 2012, Michael Gunderson - Dual licensed under the MIT or GPL Version 2 licenses. Same as jQuery.
 */(function(a){a.widget("ui.sessiondialog",a.ui.dialog,{options:{url:null,timeoutInterval:18e5,countDownTimeout:20,countDownElement:null,resetOnActivity:!1},_mainTimeout:null,_countDownInterval:null,_$document:a(document),_eventNamespace:".sessUsrEvents"+Math.floor(Math.random()*100),_showTimeout:function(){this._trigger("showTimeoutWarning",this),this.open()},_hideTimeout:function(){this._trigger("hideTimeoutWarning",this),this.close()},_setTrackingEvents:function(){if(this.options.resetOnActivity){var a=this;this._$document.on("click"+this._eventNamespace,function(){a._resetSession.call(a,!0)}).on("keyup"+this._eventNamespace,function(){a._resetSession.call(a,!0)})}},_stopTrackingEvents:function(){this.options.resetOnActivity&&this._$document.off(this._eventNamespace)},_clearTimers:function(){this._countDownInterval&&clearInterval(this._countDownInterval),this._mainTimeout&&clearTimeout(this._mainTimeout)},_sessionTimeoutWarning:function(){this._stopTrackingEvents();var a=this.options.countDownTimeout,b=this;this.options.countDownElement&&this.options.countDownElement.text(a),this._showTimeout(),this._countDownInterval=setInterval(function(){a<=0&&(clearInterval(b._countDownInterval),b._trigger("sessionTimeout",b),b.close(),b.options.url&&window.location.replace(b.options.url)),a--,b.options.countDownElement&&b.options.countDownElement.text(a)},1e3)},_extendSession:function(){this._trigger("extendSession",this),this._resetSession()},_resetSession:function(a){var b=this;this._clearTimers(),this._mainTimeout=setTimeout(function(){b._sessionTimeoutWarning.call(b)},this.options.timeoutInterval),a||(this._hideTimeout(),this._stopTrackingEvents(),this._setTrackingEvents())},_create:function(){var b=this,c=null;if(this.options.buttons){for(var d in this.options.buttons)if(this.options.buttons[d].hasOwnProperty("extendTime")&&this.options.buttons[d].extendTime){c=this.options.buttons[d];break}if(!c)throw"No button found with the extendTime option.";var e=null;c.hasOwnProperty("click")&&(e=c.click,c.click=function(){b._extendSession(),e.call(this)})}return a.ui.dialog.prototype._create.call(this,this.options),this.element.parents("div.ui-dialog").find("div.ui-dialog-titlebar a.ui-dialog-titlebar-close").hide(),this._resetSession(),this}})})(jQuery);